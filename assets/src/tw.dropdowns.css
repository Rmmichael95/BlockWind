/* ==========================================================
   MODULE: tw.dropdown.css
   Purpose: Navigation dropdown styling for BlockWind / core Navigation block.
            Tailwind v4 utilities only (no Preflight), scoped to .site-nav.
            Desktop: stable hover/focus dropdowns (no “disappear instantly”).
            Mobile overlay: keep WP behavior; only style/layout.
   ========================================================== */
@reference "./tw.reference.css";

/* -------------------------
   Desktop dropdowns
   WP breakpoint ~782px
   ------------------------- */
@media (min-width: 783px) {
  /* submenu panel */
  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    ) {
    @apply hidden absolute left-0 top-full mt-2 min-w-60 rounded-lg border border-black/10 p-2 shadow-lg;
    background-color: var(--wp--preset--color--base, #fff);
    color: inherit;
  }

  /* flyout for nested */
  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container
        ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
        ul.wp-block-pages-list__submenu-container
    ) {
    @apply left-full top-0 mt-0 ml-2;
  }

  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    )
    :is(
      a.wp-block-navigation-item__content,
      button.wp-block-navigation-item__content,
      a.wp-block-pages-list__item__link
    ):is(:hover, :focus-visible) {
    @apply bg-black/5 outline-none;
  }

  /* desktop chevrons (keep simple; WP injects svg) */
  .site-nav
    :is(
      button.wp-block-navigation-submenu__toggle,
      button.wp-block-navigation__submenu-icon
    ) {
    @apply inline-flex items-center justify-center w-6 h-6 ml-1 opacity-70;
    position: static;
    transform: none;
  }

  .site-nav
    :is(
      button.wp-block-navigation-submenu__toggle,
      button.wp-block-navigation__submenu-icon
    )
    svg {
    @apply w-4 h-4 transition-transform;
  }

  /* rotate when expanded (some WP builds add aria-expanded) */
  .site-nav
    :is(
      button.wp-block-navigation-submenu__toggle[aria-expanded="true"] svg,
      button.wp-block-navigation__submenu-icon[aria-expanded="true"] svg
    ) {
    @apply rotate-180;
  }
}

/* -------------------------
   Mobile overlay menu
   .is-menu-open + .is-modal-open present on html/body
   ------------------------- */
@media (max-width: 782px) {
  /* container stack */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    .wp-block-navigation__container {
    @apply flex flex-col items-stretch justify-start gap-2 w-full;
  }

  /* ----- Parent rows: label + chevron inline, submenu wraps below ----- */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      li.wp-block-navigation-item.has-child,
      li.wp-block-pages-list__item.has-child
    ) {
    /* @apply flex flex-row flex-wrap items-center justify-start; */
    @apply flex flex-row flex-wrap;
  }

  /* Chevron toggle sits immediately after label */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      button.wp-block-navigation-submenu__toggle,
      button.wp-block-navigation__submenu-icon
    ) {
    @apply inline-flex flex-none items-center justify-center w-6 h-6 ml-1 p-0 opacity-70 cursor-pointer;
    align-self: center;
    position: static;
    transform: none;
  }

  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      button.wp-block-navigation-submenu__toggle,
      button.wp-block-navigation__submenu-icon
    ):hover {
    @apply opacity-100;
  }

  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      button.wp-block-navigation-submenu__toggle,
      button.wp-block-navigation__submenu-icon
    )
    svg {
    @apply w-4 h-4 transition-transform fill-current;
  }

  /* ----- Submenu panel: boxed dropdown inside overlay ----- */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    ) {
    @apply hidden basis-full w-full mt-2 mx-5 rounded-lg border border-black/15 p-3 shadow max-w-full min-w-0;
    background-color: var(--wp--preset--color--base, #fff);
    color: inherit;
    position: static;
    inset: auto;
    visibility: visible;
  }

  /* Open states */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      li.is-open > ul.wp-block-navigation__submenu-container,
      li.is-open > ul.wp-block-pages-list__submenu-container
    ) {
    @apply block;
  }

  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      button.wp-block-navigation-submenu__toggle[aria-expanded="true"] + ul,
      button.wp-block-navigation__submenu-icon[aria-expanded="true"] + ul,
      button.wp-block-navigation-submenu__toggle[aria-expanded="true"] ~ ul,
      button.wp-block-navigation__submenu-icon[aria-expanded="true"] ~ ul
    ) {
    @apply block;
  }

  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    )
    :is(
      a.wp-block-navigation-item__content,
      button.wp-block-navigation-item__content,
      a.wp-block-pages-list__item__link
    ):is(:hover, :focus-visible) {
    @apply bg-black/5 outline-none;
  }
}
