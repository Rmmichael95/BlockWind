/* ==========================================================
   MODULE: tw.dropdown.css
   Purpose: Navigation dropdown styling for BlockWind / core Navigation block.
            Tailwind v4 utilities only (no Preflight), scoped to .site-nav.
            Desktop: stable hover/focus dropdowns (no “disappear instantly”).
            Mobile overlay: keep WP behavior; only style/layout.
   ========================================================== */
@reference "./tw.reference.css";

/* Shared item styling inside submenu panels */
.site-nav
  :is(
    ul.wp-block-navigation__submenu-container,
    ul.wp-block-pages-list__submenu-container
  )
  :is(
    a.wp-block-navigation-item__content,
    button.wp-block-navigation-item__content,
    a.wp-block-pages-list__item__link
  ) {
  @apply block w-full rounded-md px-3 py-2 text-left;
}

/* -------------------------
   Desktop dropdowns
   WP breakpoint ~782px
   ------------------------- */
@media (min-width: 783px) {
  /* submenu panel */
  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    ) {
    @apply hidden absolute left-0 top-full mt-2 min-w-60 rounded-lg border border-black/10 p-2 shadow-md;
    background-color: var(--wp--preset--color--base, #fff);
    color: inherit;
  }

  /* Bridge the vertical gap created by mt-2 (between parent and submenu) */
  .site-nav
    :is(
      li.wp-block-navigation-item.has-child
        > ul.wp-block-navigation__submenu-container,
      li.wp-block-pages-list__item.has-child
        > ul.wp-block-pages-list__submenu-container
    )::before {
    --bw-submenu-gap-y: calc(var(--spacing, 0.25rem) * 2); /* matches mt-2 */
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: calc(-1 * var(--bw-submenu-gap-y));
    height: var(--bw-submenu-gap-y);
    background: transparent;
  }

  /* flyout for nested */
  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container
        ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
        ul.wp-block-pages-list__submenu-container
    ) {
    @apply left-full top-0 mt-0 ml-2;
  }

  .site-nav
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    )
    :is(
      a.wp-block-navigation-item__content,
      button.wp-block-navigation-item__content,
      a.wp-block-pages-list__item__link
    ):is(:hover, :focus-visible) {
    @apply bg-black/5 outline-none;
  }
}

/* -------------------------
   Mobile overlay menu
   - Only the submenu UL “box” lives here
   ------------------------- */
@media (max-width: 782px) {
  /* Submenu panel: boxed dropdown inside overlay */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      ul.wp-block-navigation__submenu-container,
      ul.wp-block-pages-list__submenu-container
    ) {
    @apply hidden basis-full w-full mt-2 mx-5 rounded-lg border border-black/15 p-3 shadow max-w-full min-w-0;
    background-color: var(--wp--preset--color--base, #fff);
    color: inherit;
    position: static;
    inset: auto;
    visibility: visible;
  }

  /* Open states */
  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      li.is-open > ul.wp-block-navigation__submenu-container,
      li.is-open > ul.wp-block-pages-list__submenu-container
    ) {
    @apply block;
  }

  .site-nav
    .wp-block-navigation__responsive-container.is-menu-open
    :is(
      button.wp-block-navigation-submenu__toggle[aria-expanded="true"] + ul,
      button.wp-block-navigation__submenu-icon[aria-expanded="true"] + ul,
      button.wp-block-navigation-submenu__toggle[aria-expanded="true"] ~ ul,
      button.wp-block-navigation__submenu-icon[aria-expanded="true"] ~ ul
    ) {
    @apply block;
  }
}
