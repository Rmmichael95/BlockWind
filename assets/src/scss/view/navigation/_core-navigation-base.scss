/* ==========================================================================
   BlockWind SCSS: Navigation (Core Mobile Modal Behavior)
   --------------------------------------------------------------------------
   Role: Base behavior + ergonomics for the core Navigation block when the
         responsive (modal) menu is open.
   Scope:
   - No wrapper assumptions (no .site-nav required).
   - Scoped to the open responsive container state only, to avoid impacting
     desktop dropdown behavior.
   What this file does:
   - Submenu visibility is driven by aria-expanded (accessibility-aligned).
   - Mobile tap targets reserve space for the submenu toggle hit area.
   - Focus-visible rings are applied using theme.json focus tokens.
   ========================================================================== */

@use "../../prelude" as *;

/* Open responsive (modal) menu state.
   WordPress commonly toggles :root.has-modal-open + .is-menu-open. */
:root.has-modal-open
  .bw-header
  .wp-block-navigation__responsive-container.is-menu-open {
  overflow-y: $bw-nav-mobile-modal-overflow-y;
  scrollbar-gutter: $bw-nav-mobile-modal-scrollbar-gutter;

  /* Prevent shrink-to-fit jitter */
  .wp-block-navigation__container,
  .wp-block-page-list {
    width: 100%;
    max-width: 100%;
    align-self: stretch;
    box-sizing: border-box;
  }

  /* Prevent anchor padding from making it wider than its parent */
  .wp-block-navigation-item__content {
    box-sizing: border-box;
  }
  /* ------------------------------------------------------------------------
     Prevent horizontal shift when submenus open:
     keep the UL from shrink-wrapping under items-justified-* alignment.
     --------------------------------------------------------------------- */

  .wp-block-navigation__container,
  .wp-block-page-list {
    width: 100%;
    max-width: 100%;
    align-self: stretch;
    box-sizing: border-box;
  }

  /* ------------------------------------------------------------------------
     Optional: Submenu show/hide driven by aria-expanded
     --------------------------------------------------------------------- */

  .wp-block-navigation .has-child .wp-block-navigation__submenu-container {
    display: none;
  }

  .wp-block-navigation-submenu__toggle[aria-expanded="true"]
    ~ .wp-block-navigation__submenu-container {
    display: flex;
  }

  /* ------------------------------------------------------------------------
     Core fix: Submenu chevron must not resize when aria-expanded changes.
     WordPress may set svg to inherit sizing; we clamp to a token value.
     --------------------------------------------------------------------- */

  /* Core fix: Submenu chevron constant size (token-driven) */
  .wp-block-navigation-submenu {
    .wp-block-navigation__submenu-icon svg,
    .wp-block-navigation-submenu-icon svg {
      width: $bw-nav-submenu-chevron-size;
      height: $bw-nav-submenu-chevron-size;
      max-width: $bw-nav-submenu-chevron-size;
      max-height: $bw-nav-submenu-chevron-size;
      flex: 0 0 $bw-nav-submenu-chevron-size;
      margin: 0;
    }
  }

  /* Mobile submenu layout (minimal, ergonomic) */
  .wp-block-navigation__submenu-container {
    box-sizing: border-box;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
    gap: $bw-nav-mobile-submenu-gap;
    padding-top: $bw-nav-mobile-submenu-padding-top;
    padding-left: $bw-nav-mobile-submenu-indent;
  }

  /* ------------------------------------------------------------------------
     Mobile tap targets + submenu toggle hit area
     --------------------------------------------------------------------- */

  /* Make navigation items full-width and position a toggle hit area. */
  li.wp-block-navigation-item,
  .wp-block-page-list li {
    width: 100%;
    position: relative;
  }

  /* Links become full-width tap targets, reserving space for the toggle. */
  .wp-block-navigation-item__content {
    display: block;
    width: 100%;
    padding: $bw-nav-item-py $bw-nav-mobile-hit-area $bw-nav-item-py
      $bw-nav-item-px;
    text-decoration: inherit;
  }

  /* Submenu toggle button: large hit area, pinned to the edge. */
  .wp-block-navigation-submenu__toggle {
    position: absolute;
    top: 0;
    right: 0;
    width: $bw-nav-mobile-hit-area;

    height: auto; /* key: prevents growing with expanded <li> */
    padding: $bw-nav-item-py 0; /* row rhythm */
    display: inline-flex;
    align-items: center;
    justify-content: center;

    z-index: 10;
    background: transparent;
    border: 0;
  }

  /* ------------------------------------------------------------------------
     Optional: Focus-visible rings (token-driven)
     --------------------------------------------------------------------- */

  .wp-block-navigation-item__content:focus-visible,
  .wp-block-navigation-submenu__toggle:focus-visible,
  .wp-block-navigation__responsive-container-open:focus-visible,
  .wp-block-navigation__responsive-container-close:focus-visible {
    outline: $bw-focus-ring-width solid $bw-focus-ring-color;
    outline-offset: $bw-focus-ring-offset;
    border-radius: $bw-focus-ring-radius;
  }
}

/* RTL adjustments (must be scoped with :root as the ancestor of body) */
:root.has-modal-open
  body.rtl
  .wp-block-navigation__responsive-container.is-menu-open {
  .wp-block-navigation__submenu-container {
    padding-left: 0;
    padding-right: $bw-nav-mobile-submenu-indent;
  }

  .wp-block-navigation-item__content {
    padding: $bw-nav-item-py $bw-nav-item-px $bw-nav-item-py
      $bw-nav-mobile-hit-area;
  }

  .wp-block-navigation-submenu__toggle {
    right: auto;
    left: 0;
  }
}
