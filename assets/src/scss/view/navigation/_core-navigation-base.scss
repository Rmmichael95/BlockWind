/* ==========================================================================
   Core Navigation: Base (state + accessibility only)
   --------------------------------------------------------------------------
   Responsibility:
   - Pure state mechanics + accessibility primitives shared across nav modes.
   - NO paint (colors/shadows), NO geometry (dropdown offsets/min-width),
     NO layout ergonomics (padding/gaps/indent) â€” those live in Desktop/Mobile.
   Scope:
   - Scoped to the open responsive container state only, to avoid impacting
     desktop dropdown behavior.
   What this file does:
   - Submenu visibility driven by aria-expanded (accessibility-aligned).
   - Prevents shrink-to-fit jitter in modal containers.
   - Clamps submenu chevron sizing to avoid SVG resize jitter.
   - Applies focus-visible rings using token-driven focus vars.
   ========================================================================== */

@use "../../prelude" as *;

/* Open responsive (modal) menu state.
   WordPress commonly toggles :root.has-modal-open + .is-menu-open. */
:root.has-modal-open .wp-block-navigation__responsive-container.is-menu-open {
  overflow-y: $bw-nav-mobile-modal-overflow-y;
  scrollbar-gutter: $bw-nav-mobile-modal-scrollbar-gutter;

  /* Prevent horizontal shift / shrink-to-fit jitter */
  .wp-block-navigation__container,
  .wp-block-page-list {
    width: 100%;
    max-width: 100%;
    align-self: stretch;
    box-sizing: border-box;
  }

  /* Prevent anchor padding from making it wider than its parent */
  .wp-block-navigation-item__content {
    box-sizing: border-box;
  }

  /* ------------------------------------------------------------------------
     Submenu show/hide driven by aria-expanded (behavior only)
     --------------------------------------------------------------------- */
  /* Start hidden by default (modal only). Keep selector scoped and specific. */
  .wp-block-navigation
    .wp-block-navigation-item.has-child
    > .wp-block-navigation__submenu-container {
    display: none;
  }

  /* WP markup can vary by version/theme. Support common patterns.
     We stay inside the open overlay container so we can win without !important. */

  /* Pattern A: toggle immediately precedes the submenu container */
  .wp-block-navigation
    .wp-block-navigation-item.has-child
    > .wp-block-navigation-submenu__toggle[aria-expanded="true"]
    + .wp-block-navigation__submenu-container {
    display: flex;
  }

  /* Pattern B: submenu container is a general sibling */
  .wp-block-navigation
    .wp-block-navigation-item.has-child
    > .wp-block-navigation-submenu__toggle[aria-expanded="true"]
    ~ .wp-block-navigation__submenu-container {
    display: flex;
  }

  /* Pattern C: aria-expanded is on the submenu wrapper */
  .wp-block-navigation
    .wp-block-navigation-submenu[aria-expanded="true"]
    > .wp-block-navigation__submenu-container {
    display: flex;
  }

  /* ------------------------------------------------------------------------
     Chevron sizing stability
     --------------------------------------------------------------------- */
  .wp-block-navigation-submenu {
    .wp-block-navigation__submenu-icon svg,
    .wp-block-navigation-submenu-icon svg {
      width: $bw-nav-submenu-chevron-size;
      height: $bw-nav-submenu-chevron-size;
      max-width: $bw-nav-submenu-chevron-size;
      max-height: $bw-nav-submenu-chevron-size;
      flex: 0 0 $bw-nav-submenu-chevron-size;
      margin: 0;
    }
  }

  /* ------------------------------------------------------------------------
     Focus-visible rings (token-driven)
     --------------------------------------------------------------------- */
  .wp-block-navigation-item__content:focus-visible,
  .wp-block-navigation-submenu__toggle:focus-visible,
  .wp-block-navigation__responsive-container-open:focus-visible,
  .wp-block-navigation__responsive-container-close:focus-visible {
    outline: $bw-focus-ring-width solid $bw-focus-ring-color;
    outline-offset: $bw-focus-ring-offset;
    border-radius: $bw-focus-ring-radius;
  }
}
